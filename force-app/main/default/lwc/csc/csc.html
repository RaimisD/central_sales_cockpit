<template>
    <div class="main slds-box">
        <div class="page-section page-header">
            <div class="slds-float_left slds-text-title_bold slds-text-heading_large">Central sales cockpit</div> 
            <lightning-button-icon class="slds-m-left_large" icon-name="utility:settings" variant="bare" alternative-text="Settings" title="Settings" onclick={handleOpenSettings}></lightning-button-icon>
        </div>
        <!-- <lightning-button label="Add board" title="Add board" onclick={handleAddBoard} class="slds-m-left_x-small"></lightning-button> -->
        <lightning-tabset variant="vertical">
            <template for:each={boards} for:item="board" for:index="index">
                <lightning-tab label={board.Name} key={board.Id}  onactive={handleTabSelect} value={board.Id}>
                    <div class="slds-grid">
                        <template for:each={columns} for:item="col" for:index="index">
                            <div key={col.Id} class="slds-col slds-size_1-of-12 slds-m-horizontal_xx-small">
                                <lightning-card title={col.Name} class="slds-m-bottom_small">
                                    <p>column id: {col.Id}</p>
                                </lightning-card>
                                <div class="slds-m-bottom_small">
                                    <template for:each={col.Accounts__r} for:item="Acc" for:index="index">
                                        <div key={Acc.Id}>
                                            <lightning-card class="slds-m-bottom_small">
                                                <div slot="title">
                                                    <lightning-icon icon-name="standard:account" alternative-text="Account" size="x-small" title="Account"></lightning-icon>
                                                    <a data-id={Acc.Id} onclick={navigateToRecord}>{Acc.Name}</a>
                                                </div>
                                            </lightning-card>
                                        </div>
                                    </template>
                                    <template for:each={col.Contacts__r} for:item="Contact" for:index="index">
                                        <div key={Contact.Id}>
                                            <lightning-card class="slds-m-bottom_small">
                                                <div slot="title">
                                                    <lightning-icon icon-name="standard:contact" alternative-text="contact" size="x-small" title="contact"></lightning-icon>
                                                    <a data-id={Contact.Id} onclick={navigateToRecord}>{Contact.Name}</a>
                                                </div>
                                            </lightning-card>
                                        </div>
                                    </template>
                                    <template for:each={col.Leads__r} for:item="Lead" for:index="index">
                                        <div key={Lead.Id}>
                                            <lightning-card class="slds-m-bottom_small">
                                                <div slot="title">
                                                    <lightning-icon icon-name="standard:lead" alternative-text="Lead" size="x-small" title="Lead"></lightning-icon>
                                                    <a data-id={Lead.Id} onclick={navigateToRecord}>{Lead.Name}</a>
                                                </div>
                                            </lightning-card>
                                        </div>
                                    </template>
                                    <template for:each={col.Opportunities__r} for:item="Opp" for:index="index">
                                        <div key={Opp.Id}>
                                            <lightning-card class="slds-m-bottom_small">
                                                <div slot="title">
                                                    <lightning-icon icon-name="standard:opportunity" alternative-text="Opportunity" size="x-small" title="Opportunity"></lightning-icon>
                                                    <a data-id={Opp.Id} onclick={navigateToRecord}>{Opp.Name}</a>
                                                </div>
                                            </lightning-card>
                                        </div>
                                    </template>
                                </div>  
                            </div>
                        </template> 
                        <lightning-button label="+ column" title="Add column" onclick={handleAddColumn} class="slds-m-left_x-small slds-col"></lightning-button>                     
                    </div>
                </lightning-tab>
            </template>
        </lightning-tabset>

        <!-- board creation modal -->
        <template if:true={addBoardOpen}>
            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01" class="slds-modal slds-fade-in-open">
                <!-- Modal header and close button -->
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Create a board</h1>
                        <!-- button to close the modal -->
                        <button class="slds-button slds-button_icon-inverse slds-modal__close" title="Close" onclick={handleCloseAddBoard}>
                            <lightning-icon icon-name="utility:close" alternative-text="Close"></lightning-icon>
                        </button>
                    </div>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                        <!-- Content of the modal -->
                        <lightning-record-edit-form object-api-name="Board__c" onsuccess={handleCreateBoardSuccess} onsubmit={handleCreateBoardSubmit}>
                            <lightning-input-field field-name="Name" required></lightning-input-field>
                            <lightning-button class="slds-m-top_small" type="submit" label="Create Board"></lightning-button>
                        </lightning-record-edit-form>
                    </div>
                    <div class="slds-modal__footer">
                        <!-- button to close the modal -->
                        <button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={handleCloseAddBoard}>Cancel</button>
                    </div>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </template>
        <!-- add column modal -->

        <template if:true={addColumn}>
            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01" class="slds-modal slds-fade-in-open">
                <!-- Modal header and close button -->
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-02" class="slds-modal__title slds-hyphenate">Add a column</h1>
                        <!-- button to close the modal -->
                        <button class="slds-button slds-button_icon-inverse slds-modal__close" title="Close" onclick={handleCloseAddColumn}>
                            <lightning-icon icon-name="utility:close" alternative-text="Close"></lightning-icon>
                        </button>
                    </div>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-2">
                        <!-- Content of the modal -->
                        <lightning-record-edit-form object-api-name="Board_column__c" onsuccess={handleAddColumnSuccess} onsubmit={handleAddColumnSubmit}>
                            <lightning-input-field field-name="Name" required></lightning-input-field>
                            <lightning-input-field field-name="Board__c"></lightning-input-field>
                            <lightning-button class="slds-m-top_small" type="submit" label="Add column"></lightning-button>
                        </lightning-record-edit-form>
                    </div>
                    <div class="slds-modal__footer">
                        <!-- button to close the modal -->
                        <button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={handleCloseAddColumn}>Cancel</button>
                    </div>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </template>

        <!-- board setting modal -->
        <template if:true={showSettings}>
            <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01" class="slds-modal slds-fade-in-open">
                <!-- Modal header and close button -->
                <div class="slds-modal__container">
                    <div class="slds-modal__header">
                        <h1 id="modal-heading-03" class="slds-modal__title slds-hyphenate">Board settings</h1>
                        <!-- button to close the modal -->
                        <button class="slds-button slds-button_icon-inverse slds-modal__close" title="Close" onclick={handleCloseSettings}>
                            <lightning-icon icon-name="utility:close" alternative-text="Close"></lightning-icon>
                        </button>
                    </div>
                    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-3">
                        <!-- Content of the modal -->
                        <template for:each={boards} for:item="board" for:index="index">
                            <div key={board.Id} class="slds-box slds-m-bottom_small slds-align_absolute-center">
                                <lightning-card>
                                    <p class="slds-float_left">{board.Name}</p>
                                    <p>{board.Id}</p>
                                    <lightning-button-icon icon-name="utility:edit" variant="bare" alternative-text="Edit" title="Edit" onclick={handleEdit}></lightning-button-icon>
                                    <lightning-button-icon icon-name="utility:delete" variant="bare" label="Delete" alternative-text="Delete" title="Delete" data-id={board.Id} onclick={handleDeleteBoard}></lightning-button-icon>
                                </lightning-card>
                            </div>
                        </template>
                        <lightning-button label="Add board" title="Add board" onclick={handleAddBoard} class="slds-m-left_x-small slds-align_absolute-center"></lightning-button>
                    </div>
                    <div class="slds-modal__footer">
                        <!-- button to close the modal -->
                        <button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={handleCloseSettings}>Cancel</button>
                    </div>
                </div>
            </section>
            <div class="slds-backdrop slds-backdrop_open" role="presentation"></div>
        </template>
    </div>
</template>
